# Release process

This document describes the steps to release a new version of the Dynatrace distribution of the OpenTelemetry Collector.

## Collector release prerequisites

Before starting a release, make a PR against to verify and update the following:

1. Make sure that there were no updates to the linux packages
   - check the [goreleaser files upstream](https://github.com/open-telemetry/opentelemetry-collector-releases/blob/main/distributions/otelcol-contrib/.goreleaser.yaml) for changes under the `nfpms` key
   - check the upstream installation lifecycle scripts as well as the service config files for changes:
     - `postinstall.sh`
     - `preinstall.sh`
     - `preremove.sh`
     - `otelcol.conf`
     - `otelcol.service`
2. Ensure `manifest.yaml` contains all desired Collector components at the
   desired version. It is recommended that the component versions depend on the
   same minor version of the Collector. For components in the upstream Collector
   repos, most of the time this means they will be the same version as the
   Collector version. It is okay for bugfix versions to differ.
2. Ensure the `dist.version` key in `manifest.yaml` has the version of the
   Dynatrace Collector you would like to release.
3. Ensure the changelog has been generated by running `make chlog-update
   VERSION="vX.X.X"` with your desired version.
4. Update the upstream changelog links to the relevant upstream release.
5. Look through the upstream release(s) and add any highlights to the
   corresponding section(s).
6. Ensure all `go.mod` and `go.sum` files are up-to-date by running `make gotidy`

## Making a production release

The way a production release is made is by creating and pushing a git tag which starts with the letter `v`.
The tag name MUST be a semver-compliant version string with the letter "v" prepended, for example `v1.0.0`.

1. Identify the git ref you want to release.
   Usually this will be `main` (`refs/heads/main`).
2. Check out the ref locally.

   ```sh
   git fetch origin
   git checkout main
   git reset --hard origin/main
   ```

3. Ensure the `dist.version` property of [`manifest.yaml`](../manifest.yaml) is the desired new semver-compliant version.
   If not, you will need to update it and go back to step 1.
4. Create a git tag which matches the `dist.version` property of `manifest.yaml` exactly except that it is preceded by the letter `v`.

   ```sh
   git tag v0.0.1
   ```

5. Push your new tag to github

   ```sh
   git push --tags
   ```

Once you have completed the above steps, the [Build and Release](../.github/workflows/release.yaml) workflow will use [goreleaser](https://goreleaser.com) to create a new draft release on GitHub. When it completes, the release will be visible to users with the required permissions at [Releases](https://github.com/Dynatrace/dynatrace-otel-collector/releases). The changelog and title for the release is created automatically, but may be modified. When you are happy with the state of the release, publish the release and it will become publicly visible.

**Note:**

After the release is completed, please do not forget to merge the automated renovate version update PRs for `dynatrace-otel-collector` and `opentelemetry-operator` in the [dynatrace-docs](https://bitbucket.lab.dynatrace.org/projects/SUS/repos/dynatrace-docs/browse) repository. Please be aware that automatic creation of these PRs by renovate-bot might take a few hours.
