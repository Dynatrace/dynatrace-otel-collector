apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Name }}-config
  namespace: e2eredaction
data:
  relay: |
    extensions:
      health_check:
        endpoint: 0.0.0.0:13133
    receivers:
      otlp:
        protocols:
          grpc:
            endpoint: ${env:MY_POD_IP}:4317
    processors:
      redaction:
        allow_all_keys: false
        allowed_keys:
          - description
          - group
          - name
        ignored_keys:
          - safe_attribute
        blocked_values:
          - "4[0-9]{12}(?:[0-9]{3})?" ## Visa credit card number
          - "(5[1-5][0-9]{14})"       ## MasterCard number
          - "^((25[0-5]|(2[0-4]|1\d|[1-9]|)\d)(\.(?!$)|$)){4}$" ## IPv4 addresses
          - "^[\w\.]+@([\w-]+\.)+[\w-]{2,4}$" ## email addresses
        summary: info
    exporters:
      otlp:
        endpoint: {{ .HostEndpoint }}:4317
        tls:
          insecure: true
    service:
      extensions:
        - health_check
      pipelines:
        traces:
          receivers:
            - otlp
          processors:
            - redaction
          exporters:
            - otlp
